<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Initialisation du projet - DocForm</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Initialisation du projet";
        var mkdocs_page_input_path = "01_initialisation_projet.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> DocForm
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Formations</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">JAVA</a>
    <ul class="current">
                <li class="toctree-l2 current"><a class="reference internal current" href="#">Conception de Framework</a>
    <ul class="current">
                <li class="toctree-l3"><a class="reference internal" href="../00_installation_environnement/">Installation Environnement</a>
                </li>
                <li class="toctree-l3 current"><a class="reference internal current" href="./">Initialisation du projet</a>
    <ul class="current">
    <li class="toctree-l4"><a class="reference internal" href="#prerequis">Prérequis</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#creation-dun-projet-web-maven">Création d'un projet web Maven</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#tomcat-runconfiguration">Tomcat RunConfiguration</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#connexion-a-la-base-de-donnee">Connexion à la base de donnée</a>
    </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="#">Développement du projet</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../02_a_initialisation/">Initialisation</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../02_b_architecture_hexagonale/">Architecture hexagonale</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../02_c_api_crud/">API Crud</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">DocForm</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Formations</li>
          <li class="breadcrumb-item">JAVA</li>
          <li class="breadcrumb-item">Conception de Framework</li>
      <li class="breadcrumb-item active">Initialisation du projet</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="initialisation-du-projet">Initialisation du projet</h1>
<h2 id="prerequis">Prérequis</h2>
<ul>
<li>Assurez-vous d'avoir installé IntelliJ IDEA et Maven.</li>
</ul>
<h2 id="creation-dun-projet-web-maven">Création d'un projet web Maven</h2>
<ul>
<li>Ouvrez IntelliJ IDEA sur votre ordinateur.</li>
<li>Cliquez sur "File" (Fichier) &gt; "New" (Nouveau) &gt; "Project" (Projet).</li>
<li>
<p>Dans la fenêtre "New Project", sélectionnez "Maven" dans la liste des types de projets disponibles.</p>
</li>
<li>
<p>Remplissez les champs suivants :</p>
</li>
<li>GroupId : <code>com.acensi</code></li>
<li>ArtifactId : <code>taskhandler</code></li>
<li>Version : <code>1.0-SNAPSHOT</code></li>
<li>Project Name : <code>TaskHandler</code></li>
<li>
<p>Project Location : Sélectionnez le répertoire où vous souhaitez créer votre projet.</p>
</li>
<li>
<p>Dans la section "Archetype", choisissez un archétype pour un projet web, par exemple <code>maven-archetype-webapp</code>.</p>
</li>
</ul>
<h2 id="tomcat-runconfiguration">Tomcat RunConfiguration</h2>
<ul>
<li>Ouvrez votre projet dans IntelliJ IDEA.</li>
<li>Allez dans "Run" (Exécuter) &gt; "Edit Configurations".</li>
<li>Cliquez sur le signe "+" en haut à gauche pour ajouter une nouvelle configuration.</li>
<li>Sélectionnez "Tomcat Server" &gt; "Local" dans la liste des configurations disponibles.</li>
<li>Dans la fenêtre de configuration, configurez les paramètres suivants :</li>
<li>Name : Nom de votre configuration.</li>
<li>Tomcat Server : Sélectionnez votre installation de Tomcat dans le menu déroulant.</li>
<li>Deployment : Sélectionnez votre application web (WAR ou Exploded) dans le menu déroulant.</li>
<li>Before launch : Ajoutez une étape "Build" pour compiler votre projet avant le déploiement.</li>
<li>Sous l'onglet "Deployment", configurez les options suivantes :</li>
<li>Application context : Contexte de votre application .</li>
<li>Artifact : Sélectionnez l'artefact de votre projet web Maven ou le dossier <code>webapp</code> de votre projet.</li>
</ul>
<h3 id="deploiement-de-lapplication">Déploiement de l'Application</h3>
<ul>
<li>Cliquez sur l'icône "Run" (Exécuter) ou "Debug" (Déboguer) en haut à droite.</li>
<li>Sélectionnez la configuration Tomcat que vous venez de créer dans le menu déroulant.</li>
<li>Cliquez sur "Run" ou "Debug" pour démarrer le serveur Tomcat et déployer votre application.</li>
</ul>
<h2 id="connexion-a-la-base-de-donnee">Connexion à la base de donnée</h2>
<h3 id="connexion-jndi">Connexion JNDI</h3>
<ul>
<li>
<p><a href="https://www.codejava.net/servers/tomcat/configuring-jndi-datasource-for-database-connection-pooling-in-tomcat"><strong>Connection à la base de donnée par DataSource</strong></a> :</p>
<ul>
<li>Définissez une DataSource pour tomcat dans le <strong>server.xml</strong></li>
</ul>
<p><code>&lt;Resource name="jdbc/&lt;global_resource_name&gt;" 
    auth="Container" 
    type="javax.sql.DataSource"   
    driverClassName="com.mysql.jdbc.Driver"  
    url="jdbc:mysql://localhost:3306/&lt;database_name&gt;"
    username="&lt;username&gt;"  
    password="&lt;password&gt;"
    maxTotal="100"
    maxIdle="30"
    maxWaitMillis="10000" /&gt;</code> </p>
<ul>
<li>Définissez une resource surveillée dans le <strong>context.xml</strong> de tomcat:</li>
</ul>
<p><code>&lt;WatchedResource&gt;META-INF/context.xml&lt;/WatchedResource&gt;</code> </p>
<ul>
<li>Créez un fichier <strong>context.xml</strong> que vos placerez dans le dossier <strong>"webapps/META-INF"</strong> de votre projet :</li>
</ul>
<p><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Context&gt;
  &lt;ResourceLink name="jdbc/&lt;context_resource_name&gt;"
              global="jdbc/&lt;global_resource_name&gt;"
              auth="Container"
              type="javax.sql.DataSource" /&gt;
&lt;/Context&gt;</code> </p>
</li>
<li>
<p><strong>Créez un package 'configuration'</strong>, et créez une classe 'DataSourceConfiguration' dans ce package qui aura une méthode statique <strong>'getDataSource()'</strong> avec le code suivant :</p>
<p><code>Context ctx = new InitialContext();
Context initCtx  = (Context) ctx.lookup("java:/comp/env");
this.dataSource = (DataSource) initCtx.lookup("jdbc/&lt;context_resource_name&gt;");</code></p>
</li>
</ul>
<h3 id="pool-de-connexion-hikaricp">Pool de connexion - HikariCP</h3>
<h4 id="maven">Maven</h4>
<ul>
<li>
<p>Ajout de la dépendance dans le pom.xml:</p>
<p><code>&lt;dependency&gt;
    &lt;groupId&gt;com.zaxxer&lt;/groupId&gt;
    &lt;artifactId&gt;HikariCP&lt;/artifactId&gt;
    &lt;version&gt;${com.zaxxer.hikaricp.version}&lt;/version&gt;
&lt;/dependency&gt;</code></p>
</li>
</ul>
<h4 id="configuration">Configuration</h4>
<ol>
<li>Créez une classe ConnexionPool qui a sa propre instance en propriété.<ul>
<li>créer un getter pour cette instance</li>
</ul>
</li>
<li>Ajouter une propriété HikariConfig<ul>
<li>créer une méthode qui ajoute à cette configuration la datasource passée en paramètre.</li>
</ul>
</li>
<li>Ajouter une propriété HikariDataSource<ul>
<li>créer son instance en lui passant la configuration Hikari.</li>
</ul>
</li>
<li>Ajouter une méthode permettant de récupérer une connexion depuis la datasource Hikari.</li>
</ol>
<h3 id="migration-des-donnees-liquibase">Migration des données - Liquibase</h3>
<h4 id="maven_1">Maven</h4>
<ul>
<li>
<p>Ajout de la dépendance dans le pom.xml:</p>
<p><code>&lt;dependency&gt;
  &lt;groupId&gt;org.liquibase&lt;/groupId&gt;
  &lt;artifactId&gt;liquibase-core&lt;/artifactId&gt;
  &lt;version&gt;4.15.0&lt;/version&gt;
&lt;/dependency&gt;</code></p>
</li>
</ul>
<h4 id="servlet-listener">Servlet Listener</h4>
<ol>
<li>Dans le package <strong>'configuration'</strong>, créez un package <strong>'liquibase'</strong>.</li>
<li>
<p>Dans les ressources de votre projet, créez un dossier <strong>'db'</strong> et dans ce dossier, un fichier <strong>'changelog.yaml'</strong>.</p>
<ul>
<li>Ajoutez un changeSet de création de base de donnée adaptée à votre installation, ex :</li>
</ul>
<p><code>databaseChangeLog:
  - changeSet:
      id: create-database
      author: &lt;votre_nom&gt;
      changes:
        - sql:
            dbms: &lt;votre_bdd&gt;
            endDelimiter: ;;
            splitStatements: true
            sql: "CREATE DATABASE taskhandler;"</code></p>
</li>
<li>
<p>Créez une classe <strong>'LiquibaseServletContext'</strong> qui étends <strong>'LiquibaseServletListener'</strong></p>
<ul>
<li>Définissez les propriétés suivantes pour votre classe :</li>
</ul>
<p><code>private DataSource dataSource;
private String dataSourcePath;
private String changeLogPath;
private String password;</code></p>
<ul>
<li>
<p>Surchargez la méthode <strong>'contextInitialized'</strong> :</p>
<ul>
<li>Définissez une méthode abstraite <strong>'setDatasForProperties'</strong></li>
</ul>
<p><code>public abstract void setDatasForProperties();</code></p>
<ul>
<li>Dans la méthode <strong>'contextInitialized'</strong>, appelez <strong>'setDatasForProperties'</strong>.</li>
<li>Faites une méthode <strong>'initProperties'</strong><ul>
<li>On récupère les métadonnées de la DataSource en propriété de classe et via System.Property définissez les propriétés de liquibase suivantes :<ul>
<li>liquibase.driver,</li>
<li>liquibase.url</li>
<li>liquibase.username</li>
<li>liquibase.datasource</li>
<li>liquibase.changelog</li>
<li>liquibase.password</li>
</ul>
</li>
<li>Surchargez la méthode <strong>'contextDestroyed'</strong> :</li>
</ul>
</li>
<li>Appelez la méthode super.</li>
<li>
<p>Pour arrêter proprement les connexons potentiellement abandonnées à cause du pool de connexion on va rajouter la ligne suivante :</p>
<p><code>AbandonedConnectionCleanupThread.checkedShutdown();</code></p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Déclarez dans votre descripteur de déploiement (web.xml) votre listener :
    <code>&lt;listener&gt;
        &lt;listener-class&gt;configuration.liquibase.LiquibaseConfiguration&lt;/listener-class&gt;
    &lt;/listener&gt;</code></p>
</li>
</ol>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../00_installation_environnement/" class="btn btn-neutral float-left" title="Installation Environnement"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../02_a_initialisation/" class="btn btn-neutral float-right" title="Initialisation">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../00_installation_environnement/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../02_a_initialisation/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
